PS C:\Coding\bipolar-api-deploy> python -m pytest -q
.F.FFFFF.FFFFFFFFFFFFFFFFFFF.....FFFFFFFFFF....FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF..F................F............FFFF..FFFF.F...F..F......................F.FFF.F                                             [100%]
=================================================================================================== FAILURES ===================================================================================================
___________________________________________________________________________________________ test_export_patient_data ___________________________________________________________________________________________

    def test_export_patient_data():
        """Test exporting patient data"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"

        profile_data = [{
            "id": test_user_id,
            "email": "patient@example.com",
            "role": "patient",
            "is_admin": False,
            "created_at": "2024-01-01T00:00:00Z"
        }]

        mock_client = create_mock_supabase_client(
            return_data=profile_data,
            auth_user=MockUser(test_user_id, "patient@example.com")
        )

        # Setup different responses for different tables
        def mock_table(table_name):
            chain = MagicMock()

            if table_name == 'profiles':
                data = profile_data
            elif table_name == 'check_ins':
                data = [{"id": "check1", "user_id": test_user_id, "checkin_date": "2024-01-01"}]
            elif table_name == 'crisis_plan':
                data = []
            else:
                data = []

            async def mock_execute():
                return MockSupabaseResponse(data)

            for method in ['execute', 'eq', 'select', 'insert']:
                if method == 'execute':
                    setattr(chain, method, mock_execute)
                else:
                    setattr(chain, method, MagicMock(return_value=chain))

            return chain

        mock_client.table = mock_table

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_account_endpoints.py:145:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABB1CD70>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________________________ test_delete_request_therapist_with_patients __________________________________________________________________________________

    def test_delete_request_therapist_with_patients():
        """Test that therapist with active patients cannot delete account"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"

        profile_data = [{
            "id": test_user_id,
            "email": "therapist@example.com",
            "role": "therapist"
        }]

        mock_client = create_mock_supabase_client(
            return_data=profile_data,
            auth_user=MockUser(test_user_id, "therapist@example.com")
        )

        # Setup different responses for different tables
        call_count = {'count': 0}

        def mock_table(table_name):
            chain = MagicMock()

            if table_name == 'profiles':
                data = profile_data
            elif table_name == 'therapist_patients' and call_count['count'] == 0:
                call_count['count'] += 1
                # Return active patients
                data = [
                    {"therapist_id": test_user_id, "patient_id": "patient1", "status": "active"},
                    {"therapist_id": test_user_id, "patient_id": "patient2", "status": "active"}
                ]
            else:
                data = []

            async def mock_execute():
                return MockSupabaseResponse(data, count=len(data))

            for method in ['execute', 'eq', 'select', 'insert', 'update']:
                if method == 'execute':
                    setattr(chain, method, mock_execute)
                else:
                    setattr(chain, method, MagicMock(return_value=chain))

            return chain

        mock_client.table = mock_table

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_account_endpoints.py:221:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB36A490>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________________________ test_delete_request_patient_success ______________________________________________________________________________________

    def test_delete_request_patient_success():
        """Test successful deletion request for patient"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"

        profile_data = [{
            "id": test_user_id,
            "email": "patient@example.com",
            "role": "patient"
        }]

        mock_client = create_mock_supabase_client(
            return_data=profile_data,
            auth_user=MockUser(test_user_id, "patient@example.com")
        )

        # Setup different responses for different tables
        def mock_table(table_name):
            chain = MagicMock()

            if table_name == 'profiles' and hasattr(chain, '_is_select'):
                # Second call to get token
                data = [{"deletion_token": "new-token-uuid"}]
            elif table_name == 'profiles':
                data = profile_data
            elif table_name == 'therapist_patients':
                # Patient has a therapist
                data = [{"therapist_id": "therapist-id", "patient_id": test_user_id, "status": "active"}]
            else:
                data = []

            async def mock_execute():
                return MockSupabaseResponse(data)

            for method in ['execute', 'eq', 'select', 'insert', 'update']:
                if method == 'execute':
                    setattr(chain, method, mock_execute)
                else:
                    if method == 'select':
                        chain._is_select = True
                    setattr(chain, method, MagicMock(return_value=chain))

            return chain

        mock_client.table = mock_table

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_account_endpoints.py:283:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABEDF9D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________________________________________ test_undo_delete_invalid_token ________________________________________________________________________________________

    def test_undo_delete_invalid_token():
        """Test undo delete with invalid token"""
        mock_client = create_mock_supabase_client(return_data=[])

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_account_endpoints.py:309:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AC01A9E0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________________________ test_undo_delete_success ___________________________________________________________________________________________

    def test_undo_delete_success():
        """Test successful undo of deletion"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"
        test_token = "abc12345-e89b-12d3-a456-426614174999"

        # Future deletion date (still in grace period)
        future_date = (datetime.now(timezone.utc) + timedelta(days=10)).isoformat()

        profile_data = [{
            "id": test_user_id,
            "email": "patient@example.com",
            "deletion_scheduled_at": future_date
        }]

        mock_client = create_mock_supabase_client(return_data=profile_data)

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_account_endpoints.py:342:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AC01A2C0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________________________ test_undo_delete_expired ___________________________________________________________________________________________

    def test_undo_delete_expired():
        """Test undo delete with expired token (past deletion date)"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"
        test_token = "abc12345-e89b-12d3-a456-426614174999"

        # Past deletion date (grace period expired)
        past_date = (datetime.now(timezone.utc) - timedelta(days=1)).isoformat()

        profile_data = [{
            "id": test_user_id,
            "email": "patient@example.com",
            "deletion_scheduled_at": past_date
        }]

        mock_client = create_mock_supabase_client(return_data=profile_data)

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_account_endpoints.py:377:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABC70290>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestAdminAuthentication.test_generate_data_without_auth_returns_401 ______________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230ABA2BB10>, client = <starlette.testclient.TestClient object at 0x00000230ABC70CB0>, mock_env = None

    def test_generate_data_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:151:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABFDF570>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________ TestAdminAuthentication.test_generate_data_with_invalid_token_returns_401 ___________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230AB990410>, client = <starlette.testclient.TestClient object at 0x00000230ABAEC5A0>, mock_env = None

    def test_generate_data_with_invalid_token_returns_401(self, client, mock_env):
        """Test that request with invalid token (no user) is rejected."""
        async def mock_create(*args, **kwargs):
            # Return client with no user (auth.get_user returns None)
            return create_mock_supabase_client(mock_user=None)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:166:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABAEC7C0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestAdminAuthentication.test_generate_data_with_admin_email_succeeds _____________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230ABFD8B00>, client = <starlette.testclient.TestClient object at 0x00000230ABAED6A0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2F0050>

    def test_generate_data_with_admin_email_succeeds(self, client, mock_env, admin_user):
        """Test that request with admin email succeeds."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:181:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2C5450>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestAdminAuthentication.test_generate_data_with_admin_role_succeeds ______________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230ABFD88A0>, client = <starlette.testclient.TestClient object at 0x00000230ABAECC00>, mock_env = None

    def test_generate_data_with_admin_role_succeeds(self, client, mock_env):
        """Test that request with admin role in user_metadata succeeds."""
        # User with different email but admin role
        admin_role_user = MockUser(email="other@domain.com", user_metadata={"role": "admin"})

        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_role_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:199:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2C6050>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________ TestAdminAuthentication.test_generate_data_with_non_admin_user_returns_403 __________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230AB8AB9B0>, client = <starlette.testclient.TestClient object at 0x00000230ABAEC160>, mock_env = None
non_admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230ABCDE710>

    def test_generate_data_with_non_admin_user_returns_403(self, client, mock_env, non_admin_user):
        """Test that request with non-admin user returns 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:214:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABCCBE30>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________ TestAdminAuthentication.test_generate_data_without_bearer_prefix_returns_401 _________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230AB9338A0>, client = <starlette.testclient.TestClient object at 0x00000230ABAECF30>, mock_env = None

    def test_generate_data_without_bearer_prefix_returns_401(self, client, mock_env):
        """Test that authorization header without Bearer prefix is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:230:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2CCF50>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestAdminAuthentication.test_admin_auth_missing_anon_key_returns_500 _____________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230AB933790>, client = <starlette.testclient.TestClient object at 0x00000230ABAED150>
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000230AD2C7950>

    def test_admin_auth_missing_anon_key_returns_500(self, client, monkeypatch):
        """Test that missing ANON key raises configuration error."""
        # Set up environment without ANON key
        mock_service_key = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9." + "x" * 150
        monkeypatch.setenv("SUPABASE_URL", "https://test.supabase.co")
        monkeypatch.setenv("SUPABASE_SERVICE_KEY", mock_service_key)
        # Explicitly unset ANON_KEY to simulate missing config
        monkeypatch.delenv("SUPABASE_ANON_KEY", raising=False)
        monkeypatch.setenv("ADMIN_EMAILS", "admin@example.com")

        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:253:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC26D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestAdminAuthentication.test_admin_auth_uses_anon_client_not_service _____________________________________________________________________

self = <tests.test_admin_endpoints.TestAdminAuthentication object at 0x00000230AB912E50>, client = <starlette.testclient.TestClient object at 0x00000230ABAEFCE0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AC01BE10>

    def test_admin_auth_uses_anon_client_not_service(self, client, mock_env, admin_user):
        """Test that admin authentication uses ANON client, not SERVICE client."""
        anon_client_used = []

        async def tracking_acreate(url, key, options=None):
            # Check which key is being used by looking at headers
            if options and hasattr(options, 'headers'):
                headers = options.headers
                # Use module constants for key length comparison
                # ANON key is shorter than SERVICE key
                from api.dependencies import MIN_SERVICE_KEY_LENGTH
                if 'apikey' in headers and len(headers['apikey']) < MIN_SERVICE_KEY_LENGTH:
                    anon_client_used.append(True)
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=tracking_acreate):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:279:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC2510>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________ TestDataGeneration.test_generate_data_default_parameters ___________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230AB990690>, client = <starlette.testclient.TestClient object at 0x00000230ABAEF350>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2B4180>

    def test_generate_data_default_parameters(self, client, mock_env, admin_user):
        """Test data generation with default parameters."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:302:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC2A50>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________ TestDataGeneration.test_generate_data_custom_parameters ____________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230AB990550>, client = <starlette.testclient.TestClient object at 0x00000230ABAEFAC0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD244290>

    def test_generate_data_custom_parameters(self, client, mock_env, admin_user):
        """Test data generation with custom parameters."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:325:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC3BD0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________________ TestDataGeneration.test_generate_data_invalid_mood_pattern __________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFD8510>, client = <starlette.testclient.TestClient object at 0x00000230ABDFC270>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230ABDFC380>

    def test_generate_data_invalid_mood_pattern(self, client, mock_env, admin_user):
        """Test that invalid mood pattern is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:348:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FC590>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_______________________________________________________________________ TestDataGeneration.test_generate_data_validates_num_users_range ________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFD82B0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFC5A0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230ABDFC160>

    def test_generate_data_validates_num_users_range(self, client, mock_env, admin_user):
        """Test that num_users is validated within range."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:367:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FC750>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________ TestDataGeneration.test_generate_data_validates_checkins_per_user_range ____________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230AB8AB770>, client = <starlette.testclient.TestClient object at 0x00000230ABDFC7C0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD23E450>

    def test_generate_data_validates_checkins_per_user_range(self, client, mock_env, admin_user):
        """Test that checkins_per_user is validated within range."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:389:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FC130>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________________ TestDataGeneration.test_generate_data_returns_user_ids ____________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFDC8D0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFC9E0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD23EC50>

    def test_generate_data_returns_user_ids(self, client, mock_env, admin_user):
        """Test that generated user IDs are returned in response."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:411:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FC3D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
______________________________________________________________________ TestDataGeneration.test_generate_data_with_patients_and_therapists ______________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFDC9E0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFCC00>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2F8230>

    def test_generate_data_with_patients_and_therapists(self, client, mock_env, admin_user):
        """Test data generation with specific patient and therapist counts."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:435:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FC9F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________________ TestDataGeneration.test_generate_data_only_patients ______________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFD3350>, client = <starlette.testclient.TestClient object at 0x00000230ABDFCE20>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2F8F50>

    def test_generate_data_only_patients(self, client, mock_env, admin_user):
        """Test data generation with only patients."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:458:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FCBB0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________________ TestDataGeneration.test_generate_data_only_therapists _____________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFD3550>, client = <starlette.testclient.TestClient object at 0x00000230ABDFD040>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2FD010>

    def test_generate_data_only_therapists(self, client, mock_env, admin_user):
        """Test data generation with only therapists."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:478:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FD0F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________ TestDataGeneration.test_generate_data_rejects_zero_users ___________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFCE120>, client = <starlette.testclient.TestClient object at 0x00000230ABDFD260>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2FD390>

    def test_generate_data_rejects_zero_users(self, client, mock_env, admin_user):
        """Test that requesting zero patients and zero therapists is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:500:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FD1D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________________ TestDataGeneration.test_generate_data_with_legacy_num_users __________________________________________________________________________

self = <tests.test_admin_endpoints.TestDataGeneration object at 0x00000230ABFCE300>, client = <starlette.testclient.TestClient object at 0x00000230ABDFD480>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230ABAC7520>

    def test_generate_data_with_legacy_num_users(self, client, mock_env, admin_user):
        """Test backward compatibility with legacy num_users parameter."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:518:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FD550>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________________ TestStatsEndpoint.test_stats_without_auth_returns_401 _____________________________________________________________________________

self = <tests.test_admin_endpoints.TestStatsEndpoint object at 0x00000230AB990B90>, client = <starlette.testclient.TestClient object at 0x00000230ABDFD6A0>, mock_env = None

    def test_stats_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:648:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB973BD0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________________ TestStatsEndpoint.test_stats_with_invalid_token_returns_401 __________________________________________________________________________

self = <tests.test_admin_endpoints.TestStatsEndpoint object at 0x00000230AB990CD0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFD8C0>, mock_env = None

    def test_stats_with_invalid_token_returns_401(self, client, mock_env):
        """Test that request with invalid token is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=None)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:659:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB973770>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________________ TestStatsEndpoint.test_stats_with_valid_admin_returns_counts _________________________________________________________________________

self = <tests.test_admin_endpoints.TestStatsEndpoint object at 0x00000230ABFD9350>, client = <starlette.testclient.TestClient object at 0x00000230ABDFDAE0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230ABD5FB90>

    def test_stats_with_valid_admin_returns_counts(self, client, mock_env, admin_user):
        """Test that stats endpoint returns correct counts for admin user."""
        # Create mock that returns count data
        mock_client = MagicMock()

        # Mock response with count attribute
        class MockCountResponse:
            def __init__(self, count_value, data_value=None):
                self.count = count_value
                self.data = data_value if data_value is not None else []

        async def mock_execute_with_count(count_value, data_value=None):
            return MockCountResponse(count_value, data_value)

        # Create a flexible chain mock that supports all query builder methods
        def create_query_chain(table_name):
            chain_mock = MagicMock()

            # Default behavior for most chains
            if table_name == 'profiles':
                # For profiles table, return different responses based on query type
                async def profiles_execute():
                    # Check if it's a count query (head=True) or data query
                    return MockCountResponse(150, [])  # count=150, empty data for head=True queries
                chain_mock.execute = profiles_execute
            elif table_name == 'check_ins':
                # For check_ins, also return counts
                async def checkins_execute():
                    return MockCountResponse(3500, [])
                chain_mock.execute = checkins_execute
            else:
                # Generic table
                async def generic_execute():
                    return MockCountResponse(0, [])
                chain_mock.execute = generic_execute

            # Support all chain methods by returning self
            for method in ['select', 'eq', 'gte', 'lt', 'is_', 'in_', 'order', 'limit', 'head']:
                setattr(chain_mock, method, MagicMock(return_value=chain_mock))

            return chain_mock

        mock_client.table = create_query_chain

        # Mock auth.get_user for admin
        async def mock_get_user(jwt=None):
            return MockUserResponse(admin_user)

        mock_auth = MagicMock()
        mock_auth.get_user = mock_get_user
        mock_client.auth = mock_auth

        async def mock_create_stats(*args, **kwargs):
            return mock_client

>       with patch("api.dependencies.acreate_client", side_effect=mock_create_stats):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:723:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB98FA10>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________ TestStatsEndpoint.test_stats_with_non_admin_returns_403 ____________________________________________________________________________

self = <tests.test_admin_endpoints.TestStatsEndpoint object at 0x00000230ABFD95B0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFDD00>, mock_env = None
non_admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230ABD5FF50>

    def test_stats_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:741:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB98E350>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_______________________________________________________________________________ TestStatsEndpoint.test_stats_handles_zero_counts _______________________________________________________________________________

self = <tests.test_admin_endpoints.TestStatsEndpoint object at 0x00000230AB8AB1D0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFDF20>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD278AA0>

    def test_stats_handles_zero_counts(self, client, mock_env, admin_user):
        """Test that stats endpoint handles zero counts correctly."""
        mock_client = MagicMock()

        class MockCountResponse:
            def __init__(self, count_value):
                self.count = count_value
                self.data = []

        async def mock_execute():
            return MockCountResponse(0)

        # Create a flexible chain mock
        def create_query_chain(table_name):
            chain_mock = MagicMock()
            chain_mock.execute = mock_execute

            # Support all chain methods
            for method in ['select', 'eq', 'gte', 'lt', 'is_', 'in_', 'order', 'limit', 'head']:
                setattr(chain_mock, method, MagicMock(return_value=chain_mock))

            return chain_mock

        mock_client.table = create_query_chain

        # Mock auth for admin
        async def mock_get_user(jwt=None):
            return MockUserResponse(admin_user)

        mock_auth = MagicMock()
        mock_auth.get_user = mock_get_user
        mock_client.auth = mock_auth

        async def mock_create_zero(*args, **kwargs):
            return mock_client

>       with patch("api.dependencies.acreate_client", side_effect=mock_create_zero):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:786:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB9526D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________________ TestUsersEndpoint.test_users_without_auth_returns_401 _____________________________________________________________________________

self = <tests.test_admin_endpoints.TestUsersEndpoint object at 0x00000230AB990E10>, client = <starlette.testclient.TestClient object at 0x00000230ABDFE140>, mock_env = None

    def test_users_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:806:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB9AB310>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________________ TestUsersEndpoint.test_users_with_invalid_token_returns_401 __________________________________________________________________________

self = <tests.test_admin_endpoints.TestUsersEndpoint object at 0x00000230AB990F50>, client = <starlette.testclient.TestClient object at 0x00000230ABDFE360>, mock_env = None

    def test_users_with_invalid_token_returns_401(self, client, mock_env):
        """Test that request with invalid token is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=None)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:817:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB9502F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_______________________________________________________________________ TestUsersEndpoint.test_users_with_valid_admin_returns_users_list _______________________________________________________________________

self = <tests.test_admin_endpoints.TestUsersEndpoint object at 0x00000230ABFD96E0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFE580>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD279C80>

    def test_users_with_valid_admin_returns_users_list(self, client, mock_env, admin_user):
        """Test that users endpoint returns list of users for admin."""
        mock_client = MagicMock()

        # Mock users data
        users_data = [
            {"id": "user-1", "email": "user1@example.com"},
            {"id": "user-2", "email": "user2@example.com"},
            {"id": "user-3", "email": "user3@example.com"},
        ]

        async def mock_execute():
            return MockSupabaseResponse(users_data)

        # Setup the mock chain
        chain_mock = MagicMock()
        chain_mock.select = MagicMock(return_value=chain_mock)
        chain_mock.order = MagicMock(return_value=chain_mock)
        chain_mock.limit = MagicMock(return_value=chain_mock)
        chain_mock.execute = mock_execute

        mock_client.table = MagicMock(return_value=chain_mock)

        # Mock auth for admin
        async def mock_get_user(jwt=None):
            return MockUserResponse(admin_user)

        mock_auth = MagicMock()
        mock_auth.get_user = mock_get_user
        mock_client.auth = mock_auth

        async def mock_create_users(*args, **kwargs):
            return mock_client

>       with patch("api.dependencies.acreate_client", side_effect=mock_create_users):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:860:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABA074D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________ TestUsersEndpoint.test_users_with_non_admin_returns_403 ____________________________________________________________________________

self = <tests.test_admin_endpoints.TestUsersEndpoint object at 0x00000230ABFD9810>, client = <starlette.testclient.TestClient object at 0x00000230ABDFE7A0>, mock_env = None
non_admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD274190>

    def test_users_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:882:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABA07070>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________________________ TestUsersEndpoint.test_users_returns_empty_list_when_no_users _________________________________________________________________________

self = <tests.test_admin_endpoints.TestUsersEndpoint object at 0x00000230ABFE0050>, client = <starlette.testclient.TestClient object at 0x00000230ABDFE9C0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2745F0>

    def test_users_returns_empty_list_when_no_users(self, client, mock_env, admin_user):
        """Test that users endpoint returns empty list when no users exist."""
        mock_client = MagicMock()

        async def mock_execute():
            return MockSupabaseResponse([])

        chain_mock = MagicMock()
        chain_mock.select = MagicMock(return_value=chain_mock)
        chain_mock.order = MagicMock(return_value=chain_mock)
        chain_mock.limit = MagicMock(return_value=chain_mock)
        chain_mock.execute = mock_execute

        mock_client.table = MagicMock(return_value=chain_mock)

        # Mock auth for admin
        async def mock_get_user(jwt=None):
            return MockUserResponse(admin_user)

        mock_auth = MagicMock()
        mock_auth.get_user = mock_get_user
        mock_client.auth = mock_auth

        async def mock_create_empty(*args, **kwargs):
            return mock_client

>       with patch("api.dependencies.acreate_client", side_effect=mock_create_empty):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:917:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABA07690>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_without_auth_returns_401 ____________________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230AB9911D0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFEBE0>, mock_env = None

    def test_danger_zone_cleanup_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1050:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABA07850>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_with_non_admin_returns_403 ___________________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230AB991310>, client = <starlette.testclient.TestClient object at 0x00000230ABDFEE00>, mock_env = None
non_admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD2945F0>

    def test_danger_zone_cleanup_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1064:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABA07AF0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_invalid_action_returns_400 ___________________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230ABFD9BA0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFF020>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AC0CD550>

    def test_danger_zone_cleanup_invalid_action_returns_400(self, client, mock_env, admin_user):
        """Test that invalid action returns 422 (Pydantic validation error)."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1079:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FC910>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_delete_last_n_without_quantity_returns_400 ___________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230ABFD9CD0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFF240>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AC064BD0>

    def test_danger_zone_cleanup_delete_last_n_without_quantity_returns_400(self, client, mock_env, admin_user):
        """Test that delete_last_n without quantity returns 400."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1095:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FD7F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_delete_by_mood_without_pattern_returns_400 ___________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230AB8AAD50>, client = <starlette.testclient.TestClient object at 0x00000230ABDFF460>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD25CF30>

    def test_danger_zone_cleanup_delete_by_mood_without_pattern_returns_400(self, client, mock_env, admin_user):
        """Test that delete_by_mood without mood_pattern returns 400."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1110:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FD9B0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_delete_before_date_without_date_returns_400 __________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230AB933DF0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFF680>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD25E970>

    def test_danger_zone_cleanup_delete_before_date_without_date_returns_400(self, client, mock_env, admin_user):
        """Test that delete_before_date without before_date returns 400."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1125:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FDB70>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
______________________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_delete_all_success _______________________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230ABFDC6B0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFF8A0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD25DFD0>

    def test_danger_zone_cleanup_delete_all_success(self, client, mock_env, admin_user):
        """Test successful delete_all action."""
        mock_client = MagicMock()

        # Mock test patients
        test_patients = [
            {"id": "test-1", "email": "test1@example.com", "is_test_patient": True, "deleted_at": None, "created_at": "2024-01-01T00:00:00Z"},
            {"id": "test-2", "email": "test2@example.com", "is_test_patient": True, "deleted_at": None, "created_at": "2024-01-02T00:00:00Z"},
        ]

        async def mock_profiles_execute():
            return MockSupabaseResponse(test_patients)

        async def mock_delete_execute():
            return MockSupabaseResponse([])

        async def mock_audit_execute():
            return MockSupabaseResponse([{"id": "audit-1"}])

        # Setup mock chain for profiles select
        profiles_chain = MagicMock()
        profiles_chain.select = MagicMock(return_value=profiles_chain)
        profiles_chain.eq = MagicMock(return_value=profiles_chain)
        profiles_chain.is_ = MagicMock(return_value=profiles_chain)
        profiles_chain.execute = mock_profiles_execute

        # Setup mock chain for delete operations
        delete_chain = MagicMock()
        delete_chain.delete = MagicMock(return_value=delete_chain)
        delete_chain.in_ = MagicMock(return_value=delete_chain)
        delete_chain.eq = MagicMock(return_value=delete_chain)
        delete_chain.execute = mock_delete_execute

        # Setup mock chain for audit log
        audit_chain = MagicMock()
        audit_chain.insert = MagicMock(return_value=audit_chain)
        audit_chain.execute = mock_audit_execute

        # Track which table calls we've made
        table_calls = {'profiles': 0}

        def mock_table(table_name):
            if table_name == 'profiles':
                table_calls['profiles'] += 1
                # First call is for select, second is for delete
                return profiles_chain if table_calls['profiles'] == 1 else delete_chain
            elif table_name == 'audit_log':
                return audit_chain
            else:
                # Other tables (check_ins, crisis_plan, etc.)
                return delete_chain

        mock_client.table = mock_table

        # Mock auth for admin
        async def mock_get_user(jwt=None):
            return MockUserResponse(admin_user)

        mock_auth = MagicMock()
        mock_auth.get_user = mock_get_user
        mock_client.auth = mock_auth

        async def mock_create(*args, **kwargs):
            return mock_client

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1200:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FDD30>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_delete_last_n_success _____________________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230AB961350>, client = <starlette.testclient.TestClient object at 0x00000230ABDFFAC0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD25E740>

    def test_danger_zone_cleanup_delete_last_n_success(self, client, mock_env, admin_user):
        """Test successful delete_last_n action."""
        mock_client = MagicMock()

        # Mock test patients (5 total, delete 2 most recent)
        test_patients = [
            {"id": f"test-{i}", "email": f"test{i}@example.com", "is_test_patient": True,
             "deleted_at": None, "created_at": f"2024-01-{i:02d}T00:00:00Z"}
            for i in range(1, 6)
        ]

        async def mock_profiles_execute():
            return MockSupabaseResponse(test_patients)

        async def mock_delete_execute():
            return MockSupabaseResponse([])

        async def mock_audit_execute():
            return MockSupabaseResponse([{"id": "audit-1"}])

        profiles_chain = MagicMock()
        profiles_chain.select = MagicMock(return_value=profiles_chain)
        profiles_chain.eq = MagicMock(return_value=profiles_chain)
        profiles_chain.is_ = MagicMock(return_value=profiles_chain)
        profiles_chain.execute = mock_profiles_execute

        delete_chain = MagicMock()
        delete_chain.delete = MagicMock(return_value=delete_chain)
        delete_chain.in_ = MagicMock(return_value=delete_chain)
        delete_chain.eq = MagicMock(return_value=delete_chain)
        delete_chain.execute = mock_delete_execute

        audit_chain = MagicMock()
        audit_chain.insert = MagicMock(return_value=audit_chain)
        audit_chain.execute = mock_audit_execute

        table_calls = {'profiles': 0}

        def mock_table(table_name):
            if table_name == 'profiles':
                table_calls['profiles'] += 1
                return profiles_chain if table_calls['profiles'] == 1 else delete_chain
            elif table_name == 'audit_log':
                return audit_chain
            else:
                return delete_chain

        mock_client.table = mock_table

        async def mock_get_user(jwt=None):
            return MockUserResponse(admin_user)

        mock_auth = MagicMock()
        mock_auth.get_user = mock_get_user
        mock_client.auth = mock_auth

        async def mock_create(*args, **kwargs):
            return mock_client

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1271:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FDEF0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________ TestDangerZoneCleanup.test_danger_zone_cleanup_no_test_patients_found _____________________________________________________________________

self = <tests.test_admin_endpoints.TestDangerZoneCleanup object at 0x00000230AB961550>, client = <starlette.testclient.TestClient object at 0x00000230ABDFFCE0>, mock_env = None
admin_user = <tests.test_admin_endpoints.MockUser object at 0x00000230AD25FA10>

    def test_danger_zone_cleanup_no_test_patients_found(self, client, mock_env, admin_user):
        """Test when no test patients are found."""
        mock_client = MagicMock()

        async def mock_execute():
            return MockSupabaseResponse([])

        chain_mock = MagicMock()
        chain_mock.select = MagicMock(return_value=chain_mock)
        chain_mock.eq = MagicMock(return_value=chain_mock)
        chain_mock.is_ = MagicMock(return_value=chain_mock)
        chain_mock.execute = mock_execute

        mock_client.table = MagicMock(return_value=chain_mock)

        async def mock_get_user(jwt=None):
            return MockUserResponse(admin_user)

        mock_auth = MagicMock()
        mock_auth.get_user = mock_get_user
        mock_client.auth = mock_auth

        async def mock_create(*args, **kwargs):
            return mock_client

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints.py:1308:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FE0B0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
______________________________________________________________________ TestCleanupDataEndpoint.test_cleanup_data_without_auth_returns_401 ______________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestCleanupDataEndpoint object at 0x00000230AB991590>, client = <starlette.testclient.TestClient object at 0x00000230ABDFFF00>, mock_env = None

    def test_cleanup_data_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:120:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FE5F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________ TestCleanupDataEndpoint.test_cleanup_data_with_invalid_token_returns_401 ___________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestCleanupDataEndpoint object at 0x00000230AB991450>, client = <starlette.testclient.TestClient object at 0x00000230AD3E0160>, mock_env = None

    def test_cleanup_data_with_invalid_token_returns_401(self, client, mock_env):
        """Test that request with invalid token is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=None)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:134:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FD710>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestCleanupDataEndpoint.test_cleanup_data_with_non_admin_returns_403 _____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestCleanupDataEndpoint object at 0x00000230ABFD83E0>, client = <starlette.testclient.TestClient object at 0x00000230AD3E0380>, mock_env = None
non_admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD3DC1A0>

    def test_cleanup_data_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:149:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FE970>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________ TestCleanupDataEndpoint.test_cleanup_data_without_confirmation_returns_400 __________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestCleanupDataEndpoint object at 0x00000230ABFDA520>, client = <starlette.testclient.TestClient object at 0x00000230AD3E05A0>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230ABCDFED0>

    def test_cleanup_data_without_confirmation_returns_400(self, client, mock_env, admin_user):
        """Test that cleanup without confirmation is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:164:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FEA50>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
______________________________________________________________________________ TestCleanupDataEndpoint.test_cleanup_data_success _______________________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestCleanupDataEndpoint object at 0x00000230ABFE1010>, client = <starlette.testclient.TestClient object at 0x00000230AD3E07C0>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD340050>

    def test_cleanup_data_success(self, client, mock_env, admin_user):
        """Test successful cleanup operation."""
        # Mock synthetic users
        synthetic_users = [
            {"id": "user-1", "email": "test1@example.com"},
            {"id": "user-2", "email": "test2@example.org"},
        ]

        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(return_data=synthetic_users, mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:185:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FEC10>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________ TestSyntheticDataCleanEndpoint.test_synthetic_clean_without_auth_returns_401 _________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataCleanEndpoint object at 0x00000230AB9916D0>, client = <starlette.testclient.TestClient object at 0x00000230AD3E09E0>, mock_env = None

    def test_synthetic_clean_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:206:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FEDD0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________________ TestSyntheticDataCleanEndpoint.test_synthetic_clean_with_non_admin_returns_403 ________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataCleanEndpoint object at 0x00000230AB991810>, client = <starlette.testclient.TestClient object at 0x00000230AD3E0C00>, mock_env = None
non_admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD2B6D70>

    def test_synthetic_clean_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:219:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FEF90>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________ TestSyntheticDataCleanEndpoint.test_synthetic_clean_delete_all_success ____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataCleanEndpoint object at 0x00000230ABFDA650>, client = <starlette.testclient.TestClient object at 0x00000230AD3E0E20>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD2B6FD0>

    def test_synthetic_clean_delete_all_success(self, client, mock_env, admin_user):
        """Test successful delete_all action."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(return_data=[], mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:233:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FF150>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________ TestSyntheticDataCleanEndpoint.test_synthetic_clean_delete_last_n_without_quantity_returns_400 ________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataCleanEndpoint object at 0x00000230ABFDA780>, client = <starlette.testclient.TestClient object at 0x00000230AD3E1040>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD359C70>

    def test_synthetic_clean_delete_last_n_without_quantity_returns_400(self, client, mock_env, admin_user):
        """Test that delete_last_n without quantity returns 400."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:249:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FF310>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestSyntheticDataExportEndpoint.test_export_without_auth_returns_401 _____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataExportEndpoint object at 0x00000230AB991950>, client = <starlette.testclient.TestClient object at 0x00000230ABFDEAD0>, mock_env = None

    def test_export_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:268:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB972EB0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________ TestSyntheticDataExportEndpoint.test_export_with_non_admin_returns_403 ____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataExportEndpoint object at 0x00000230AB991A90>, client = <starlette.testclient.TestClient object at 0x00000230ABDFCF30>, mock_env = None
non_admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230ABDFCD10>

    def test_export_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:278:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB9717F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________ TestSyntheticDataExportEndpoint.test_export_invalid_format_returns_400 ____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataExportEndpoint object at 0x00000230ABFDA8B0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFC6B0>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230ABDFC490>

    def test_export_invalid_format_returns_400(self, client, mock_env, admin_user):
        """Test that invalid format returns 400."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:291:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB9AA970>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________ TestSyntheticDataExportEndpoint.test_export_json_success ___________________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataExportEndpoint object at 0x00000230ABFDA9E0>, client = <starlette.testclient.TestClient object at 0x00000230ABDFC380>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD2D0450>

    def test_export_json_success(self, client, mock_env, admin_user):
        """Test successful JSON export."""
        synthetic_users = [
            {"id": "user-1", "email": "test1@example.com", "is_test_patient": True, "created_at": "2024-01-01T00:00:00Z"}
        ]

        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(return_data=synthetic_users, mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:309:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABAA6CF0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________________ TestSyntheticDataExportEndpoint.test_export_csv_success ____________________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestSyntheticDataExportEndpoint object at 0x00000230ABFE1250>, client = <starlette.testclient.TestClient object at 0x00000230ABAEEBE0>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD2C7750>

    def test_export_csv_success(self, client, mock_env, admin_user):
        """Test successful CSV export."""
        synthetic_users = [
            {"id": "user-1", "email": "test1@example.com", "is_test_patient": True, "created_at": "2024-01-01T00:00:00Z"}
        ]

        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(return_data=synthetic_users, mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:327:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABAA6B30>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________ TestToggleTestFlagEndpoint.test_toggle_flag_without_auth_returns_401 _____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestToggleTestFlagEndpoint object at 0x00000230AB991BD0>, client = <starlette.testclient.TestClient object at 0x00000230ABAED370>, mock_env = None

    def test_toggle_flag_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:345:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABAA6430>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________ TestToggleTestFlagEndpoint.test_toggle_flag_with_non_admin_returns_403 ____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestToggleTestFlagEndpoint object at 0x00000230AB991D10>, client = <starlette.testclient.TestClient object at 0x00000230ABAECE20>, mock_env = None
non_admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD2CF890>

    def test_toggle_flag_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:355:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABAA6510>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________ TestToggleTestFlagEndpoint.test_toggle_flag_patient_not_found_returns_404 ___________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestToggleTestFlagEndpoint object at 0x00000230ABFDAB10>, client = <starlette.testclient.TestClient object at 0x00000230ABAEC6B0>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AD2CEB70>

    def test_toggle_flag_patient_not_found_returns_404(self, client, mock_env, admin_user):
        """Test that non-existent patient returns 404."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(return_data=[], mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:368:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC34D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________________ TestToggleTestFlagEndpoint.test_toggle_flag_success ______________________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestToggleTestFlagEndpoint object at 0x00000230ABFDAC40>, client = <starlette.testclient.TestClient object at 0x00000230ABAEC380>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230ABDC3690>

    def test_toggle_flag_success(self, client, mock_env, admin_user):
        """Test successful flag toggle."""
        patient_data = [{"id": "patient-123", "is_test_patient": False}]

        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(return_data=patient_data, mock_user=admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:383:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC2510>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________ TestRunDeletionJobEndpoint.test_deletion_job_without_auth_returns_401 _____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestRunDeletionJobEndpoint object at 0x00000230AB991E50>, client = <starlette.testclient.TestClient object at 0x00000230ABAEC270>, mock_env = None

    def test_deletion_job_without_auth_returns_401(self, client, mock_env):
        """Test that request without authorization header is rejected."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client()

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:402:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC2A50>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
___________________________________________________________________ TestRunDeletionJobEndpoint.test_deletion_job_with_non_admin_returns_403 ____________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestRunDeletionJobEndpoint object at 0x00000230AB991F90>, client = <starlette.testclient.TestClient object at 0x00000230ABFDF020>, mock_env = None
non_admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230ABDC2430>

    def test_deletion_job_with_non_admin_returns_403(self, client, mock_env, non_admin_user):
        """Test that non-admin user gets 403 Forbidden."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=non_admin_user)

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:412:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC2C10>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________________ TestRunDeletionJobEndpoint.test_deletion_job_success _____________________________________________________________________________

self = <tests.test_admin_endpoints_additional.TestRunDeletionJobEndpoint object at 0x00000230ABFDAD70>, client = <starlette.testclient.TestClient object at 0x00000230ABFDF130>, mock_env = None
admin_user = <tests.test_admin_endpoints_additional.MockUser object at 0x00000230AC0E1090>

    def test_deletion_job_success(self, client, mock_env, admin_user):
        """Test successful deletion job execution."""
        async def mock_create(*args, **kwargs):
            return create_mock_supabase_client(mock_user=admin_user)

        # Mock the process_scheduled_deletions function
        async def mock_process_deletions():
            return {
                "processed": 5,
                "deleted": 2,
                "errors": 0
            }

>       with patch("api.dependencies.acreate_client", side_effect=mock_create):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_admin_endpoints_additional.py:433:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC3770>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________________ TestCreateUserWithRetry.test_failure_after_max_retries ____________________________________________________________________________

self = <tests.test_data_generator_retry.TestCreateUserWithRetry object at 0x00000230ABFDB100>

    @pytest.mark.asyncio
    async def test_failure_after_max_retries(self):
        """Test that it fails after max retries are exhausted."""
        from data_generator import create_user_with_retry

        mock_client = MagicMock()

        # Mock auth
        async def mock_create_user(*args, **kwargs):
            return MockAuthResponse("test-uuid-123")

        mock_auth = MagicMock()
        mock_auth.admin = MagicMock()
        mock_auth.admin.create_user = mock_create_user
        mock_client.auth = mock_auth

        # Mock table insert - always fail with duplicate error
        async def mock_insert_execute():
            raise APIError({"message": "duplicate key value violates unique constraint"})

        mock_insert_chain = MagicMock()
        mock_insert_chain.execute = mock_insert_execute

        mock_table = MagicMock()
        mock_table.insert = MagicMock(return_value=mock_insert_chain)

        mock_client.table = MagicMock(return_value=mock_table)

        # Call the function and expect HTTPException
        with pytest.raises(HTTPException) as exc_info:
            await create_user_with_retry(mock_client, "patient", max_retries=3)

        # Verify it's a 500 error about duplicates
        assert exc_info.value.status_code == 500
>       assert "duplicate" in exc_info.value.detail.lower()
E       AssertionError: assert 'duplicate' in 'falha aps todas as tentativas'
E        +  where 'falha aps todas as tentativas' = <built-in method lower of str object at 0x00000230AB7CA1F0>()
E        +    where <built-in method lower of str object at 0x00000230AB7CA1F0> = 'Falha aps todas as tentativas'.lower
E        +      where 'Falha aps todas as tentativas' = HTTPException(status_code=500, detail='Falha aps todas as tentativas').detail
E        +        where HTTPException(status_code=500, detail='Falha aps todas as tentativas') = <ExceptionInfo HTTPException(status_code=500, detail='Falha aps todas as tentativas') tblen=2>.value

tests\test_data_generator_retry.py:150: AssertionError
-------------------------------------------------------------------------------------------- Captured stderr setup ---------------------------------------------------------------------------------------------
DEBUG:asyncio:Using proactor: IocpProactor
---------------------------------------------------------------------------------------------- Captured log setup ----------------------------------------------------------------------------------------------
DEBUG    asyncio:proactor_events.py:631 Using proactor: IocpProactor
--------------------------------------------------------------------------------------------- Captured stderr call ---------------------------------------------------------------------------------------------
DEBUG:bipolar-api.data_generator:Tentativa 1/3: criando patient  guerrasophia@example.org
DEBUG:bipolar-api.data_generator:Usurio auth criado: test-uuid-123
WARNING:bipolar-api.data_generator:Duplicata na tentativa 1, tentando novamente...
DEBUG:bipolar-api.data_generator:Tentativa 2/3: criando patient  arthur-gabriel54@example.com
DEBUG:bipolar-api.data_generator:Usurio auth criado: test-uuid-123
WARNING:bipolar-api.data_generator:Duplicata na tentativa 2, tentando novamente...
DEBUG:bipolar-api.data_generator:Tentativa 3/3: criando patient  antonella93@example.net
DEBUG:bipolar-api.data_generator:Usurio auth criado: test-uuid-123
WARNING:bipolar-api.data_generator:Duplicata na tentativa 3, tentando novamente...
---------------------------------------------------------------------------------------------- Captured log call -----------------------------------------------------------------------------------------------
DEBUG    bipolar-api.data_generator:data_generator.py:255 Tentativa 1/3: criando patient  guerrasophia@example.org
DEBUG    bipolar-api.data_generator:data_generator.py:264 Usurio auth criado: test-uuid-123
WARNING  bipolar-api.data_generator:data_generator.py:286 Duplicata na tentativa 1, tentando novamente...
DEBUG    bipolar-api.data_generator:data_generator.py:255 Tentativa 2/3: criando patient  arthur-gabriel54@example.com
DEBUG    bipolar-api.data_generator:data_generator.py:264 Usurio auth criado: test-uuid-123
WARNING  bipolar-api.data_generator:data_generator.py:286 Duplicata na tentativa 2, tentando novamente...
DEBUG    bipolar-api.data_generator:data_generator.py:255 Tentativa 3/3: criando patient  antonella93@example.net
DEBUG    bipolar-api.data_generator:data_generator.py:264 Usurio auth criado: test-uuid-123
WARNING  bipolar-api.data_generator:data_generator.py:286 Duplicata na tentativa 3, tentando novamente...
_______________________________________________________________________________ test_middleware_works_with_predictions_endpoint ________________________________________________________________________________

    def test_middleware_works_with_predictions_endpoint():
        """Test that middleware works correctly with predictions endpoint"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
            # Mock the supabase client to avoid actual DB calls
            from unittest.mock import MagicMock, AsyncMock

            mock_client = MagicMock()
            mock_response = MagicMock()
            mock_response.data = []

            async def mock_execute():
                return mock_response

            chain = MagicMock()
            chain.execute = mock_execute
            chain.limit = MagicMock(return_value=chain)
            chain.order = MagicMock(return_value=chain)
            chain.eq = MagicMock(return_value=chain)
            chain.select = MagicMock(return_value=chain)

            mock_client.table = MagicMock(return_value=chain)

            async def mock_get_client(*args, **kwargs):
                return mock_client

>           with patch("api.dependencies.acreate_client", side_effect=mock_get_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_observability_middleware.py:82:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FC210>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________________________ test_predictions_endpoint_no_checkins _____________________________________________________________________________________

    def test_predictions_endpoint_no_checkins():
        """Test endpoint with user that has no check-ins"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"
        mock_client = create_mock_supabase_client([])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_predictions_endpoint.py:71:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FF5B0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
____________________________________________________________________________________ test_predictions_endpoint_with_checkin ____________________________________________________________________________________

    def test_predictions_endpoint_with_checkin():
        """Test endpoint with user that has one check-in"""
        test_user_id = "223e4567-e89b-12d3-a456-426614174001"
        # Mock check-in data
        checkin_data = {
            "id": "test-checkin-123",
            "user_id": test_user_id,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 6.5,
            "sleepQuality": 6,
            "energyLevel": 5,
            "depressedMood": 4,
            "anxietyStress": 6,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_predictions_endpoint.py:132:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FFBD0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________________________ test_predictions_endpoint_with_type_filter __________________________________________________________________________________

    def test_predictions_endpoint_with_type_filter():
        """Test endpoint with specific prediction types"""
        test_user_id = "323e4567-e89b-12d3-a456-426614174002"
        checkin_data = {
            "id": "test-checkin-123",
            "user_id": test_user_id,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 6.5,
            "sleepQuality": 6,
            "energyLevel": 5,
            "depressedMood": 4,
            "anxietyStress": 6,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_predictions_endpoint.py:190:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FCAD0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________________________ test_predictions_endpoint_with_window_days __________________________________________________________________________________

    def test_predictions_endpoint_with_window_days():
        """Test endpoint with custom window_days parameter"""
        test_user_id = "423e4567-e89b-12d3-a456-426614174003"
        checkin_data = {
            "id": "test-checkin-123",
            "user_id": test_user_id,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 6.5,
            "sleepQuality": 6,
            "energyLevel": 5,
            "depressedMood": 4,
            "anxietyStress": 6,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_predictions_endpoint.py:231:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD2FFD90>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________________________ test_prediction_of_day_endpoint_no_checkins __________________________________________________________________________________

    def test_prediction_of_day_endpoint_no_checkins():
        """Test prediction_of_day endpoint with user that has no check-ins"""
        valid_uuid = "123e4567-e89b-12d3-a456-426614174000"
        mock_client = create_mock_supabase_client([])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_predictions_endpoint.py:278:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD332270>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_________________________________________________________________________________ test_prediction_of_day_endpoint_with_checkin _________________________________________________________________________________

    def test_prediction_of_day_endpoint_with_checkin():
        """Test prediction_of_day endpoint with user that has one check-in"""
        valid_uuid = "223e4567-e89b-12d3-a456-426614174001"
        # Mock check-in data
        checkin_data = {
            "id": "test-checkin-123",
            "user_id": valid_uuid,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 6.5,
            "sleepQuality": 6,
            "energyLevel": 5,
            "depressedMood": 4,
            "anxietyStress": 6,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_predictions_endpoint.py:323:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD331E10>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________________ test_prediction_of_day_endpoint_probability_normalization ___________________________________________________________________________

    def test_prediction_of_day_endpoint_probability_normalization():
        """Test that probabilities are properly normalized and subnormals handled"""
        valid_uuid = "323e4567-e89b-12d3-a456-426614174002"
        # Mock check-in data with extreme values
        checkin_data = {
            "id": "test-checkin-extreme",
            "user_id": valid_uuid,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 10,
            "sleepQuality": 10,
            "energyLevel": 10,
            "depressedMood": 0,
            "anxietyStress": 0,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_predictions_endpoint.py:376:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD332C10>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_______________________________________________________________________________ test_prediction_of_day_endpoint_missing_env_vars _______________________________________________________________________________

    def test_prediction_of_day_endpoint_missing_env_vars():
        """Test prediction_of_day endpoint with missing environment variables"""
        with patch.dict(os.environ, {}, clear=True):
            response = client.get("/data/prediction_of_day/test-user-123")

            # Should return 500 with clear error message
>           assert response.status_code == 500
E           assert 400 == 500
E            +  where 400 = <Response [400 Bad Request]>.status_code

tests\test_predictions_endpoint.py:397: AssertionError
--------------------------------------------------------------------------------------------- Captured stderr call ---------------------------------------------------------------------------------------------
DEBUG:asyncio:Using proactor: IocpProactor
INFO:bipolar-api.middleware:Request started: {'request_id': 'a61d6cc6-eb2d-4012-bc37-373aa41f988c', 'method': 'GET', 'path': '/data/prediction_of_day/test-user-123', 'user_hash': None}
INFO:bipolar-api.middleware:Request completed: request_id=a61d6cc6-eb2d-4012-bc37-373aa41f988c, status=400, duration=220.28ms, user_hash=none
INFO:httpx:HTTP Request: GET http://testserver/data/prediction_of_day/test-user-123 "HTTP/1.1 400 Bad Request"
---------------------------------------------------------------------------------------------- Captured log call -----------------------------------------------------------------------------------------------
DEBUG    asyncio:proactor_events.py:631 Using proactor: IocpProactor
INFO     bipolar-api.middleware:middleware.py:53 Request started: {'request_id': 'a61d6cc6-eb2d-4012-bc37-373aa41f988c', 'method': 'GET', 'path': '/data/prediction_of_day/test-user-123', 'user_hash': None}
INFO     bipolar-api.middleware:middleware.py:67 Request completed: request_id=a61d6cc6-eb2d-4012-bc37-373aa41f988c, status=400, duration=220.28ms, user_hash=none
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/data/prediction_of_day/test-user-123 "HTTP/1.1 400 Bad Request"
_______________________________________________________________________________________ test_consent_endpoint_with_auth ________________________________________________________________________________________

    def test_consent_endpoint_with_auth():
        """Test consent endpoint with proper authorization"""
        test_user_id = "123e4567-e89b-12d3-a456-426614174000"
        consent_record = {
            "user_id": test_user_id,
            "analytics": True,
            "research": False,
            "personalization": True,
            "updated_at": "2024-01-15T10:30:00Z"
        }

        mock_client = create_mock_supabase_client([consent_record])

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_privacy_endpoints.py:96:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD3319B0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________________________________________ test_export_endpoint_with_auth ________________________________________________________________________________________

    def test_export_endpoint_with_auth():
        """Test export endpoint with proper authorization"""
        test_user_id = "223e4567-e89b-12d3-a456-426614174001"

        # Create mock data
        checkin_data = {
            "id": "checkin-1",
            "user_id": test_user_id,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 7.5
        }

        consent_data = {
            "user_id": test_user_id,
            "analytics": True,
            "research": False
        }

        # Create a mock client that returns different data based on the table
        mock_client = MagicMock()

        async def mock_execute_checkins():
            return MockSupabaseResponse([checkin_data])

        async def mock_execute_consent():
            return MockSupabaseResponse([consent_data])

        # Track which table is being queried
        table_responses = {
            'check_ins': mock_execute_checkins,
            'user_consent': mock_execute_consent
        }

        def mock_table(table_name):
            chain = MagicMock()
            chain.select = MagicMock(return_value=chain)
            chain.eq = MagicMock(return_value=chain)
            chain.execute = table_responses.get(table_name, mock_execute_checkins)
            return chain

        mock_client.table = mock_table

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_privacy_endpoints.py:208:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AC0DE5F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________________________________________ test_erase_endpoint_with_auth _________________________________________________________________________________________

    def test_erase_endpoint_with_auth():
        """Test erase endpoint with proper authorization"""
        test_user_id = "323e4567-e89b-12d3-a456-426614174002"

        # Create mock data for deletion
        deleted_checkins = [{"id": "checkin-1"}, {"id": "checkin-2"}]
        deleted_consent = [{"user_id": test_user_id}]

        # Create a mock client
        mock_client = MagicMock()

        async def mock_execute_delete_checkins():
            return MockSupabaseResponse(deleted_checkins)

        async def mock_execute_delete_consent():
            return MockSupabaseResponse(deleted_consent)

        table_responses = {
            'check_ins': mock_execute_delete_checkins,
            'user_consent': mock_execute_delete_consent
        }

        def mock_table(table_name):
            chain = MagicMock()
            chain.delete = MagicMock(return_value=chain)
            chain.eq = MagicMock(return_value=chain)
            chain.execute = table_responses.get(table_name, mock_execute_delete_checkins)
            return chain

        mock_client.table = mock_table

        async def mock_client_factory(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-service-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_client_factory):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_privacy_endpoints.py:301:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AD330590>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________________________________ test_latest_checkin_valid_uuid_calls_supabase _________________________________________________________________________________

    def test_latest_checkin_valid_uuid_calls_supabase():
        """Test that valid UUID successfully calls Supabase"""
        valid_uuid = "123e4567-e89b-12d3-a456-426614174000"

        checkin_data = {
            "id": "checkin-123",
            "user_id": valid_uuid,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 7.5,
            "sleepQuality": 8
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_uuid_validation.py:97:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB9AB310>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
__________________________________________________________________________________ test_predictions_valid_uuid_calls_supabase __________________________________________________________________________________

    def test_predictions_valid_uuid_calls_supabase():
        """Test that valid UUID successfully calls Supabase"""
        valid_uuid = "123e4567-e89b-12d3-a456-426614174000"

        checkin_data = {
            "id": "checkin-123",
            "user_id": valid_uuid,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 6.5,
            "sleepQuality": 6,
            "energyLevel": 5,
            "depressedMood": 4,
            "anxietyStress": 6,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_uuid_validation.py:157:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB973CB0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
________________________________________________________________________________ test_predictions_valid_uuid_with_query_params _________________________________________________________________________________

    def test_predictions_valid_uuid_with_query_params():
        """Test that valid UUID with query parameters works correctly"""
        valid_uuid = "123e4567-e89b-12d3-a456-426614174000"

        checkin_data = {
            "id": "checkin-123",
            "user_id": valid_uuid,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 6.5,
            "sleepQuality": 6,
            "energyLevel": 5,
            "depressedMood": 4,
            "anxietyStress": 6,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_uuid_validation.py:195:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230ABDC35B0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
_____________________________________________________________________________________________ test_uuid_edge_cases _____________________________________________________________________________________________

    def test_uuid_edge_cases():
        """Test edge cases for UUID validation"""
        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
            edge_cases = [
                "",  # empty string
                " ",  # whitespace
            ]

            # Empty and whitespace should return 400
            for test_case in edge_cases:
                response = client.get(f"/data/predictions/{test_case}")
                assert response.status_code in [400, 404], f"Expected 400 or 404 for: '{test_case}'"

            # Nil UUID has valid format, so should pass validation and return 200 with empty predictions
            mock_client = create_mock_supabase_client([])

            async def mock_acreate_client(*args, **kwargs):
                return mock_client

>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_uuid_validation.py:232:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AB9502F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
--------------------------------------------------------------------------------------------- Captured stderr call ---------------------------------------------------------------------------------------------
DEBUG:asyncio:Using proactor: IocpProactor
INFO:bipolar-api.middleware:Request started: {'request_id': '0620d513-f2dd-4dba-ae4a-e52862cfb887', 'method': 'GET', 'path': '/data/predictions/', 'user_hash': None}
INFO:bipolar-api.middleware:Request completed: request_id=0620d513-f2dd-4dba-ae4a-e52862cfb887, status=404, duration=0.32ms, user_hash=none
INFO:httpx:HTTP Request: GET http://testserver/data/predictions/ "HTTP/1.1 404 Not Found"
DEBUG:asyncio:Using proactor: IocpProactor
INFO:bipolar-api.middleware:Request started: {'request_id': 'dded935c-de8d-4c26-b871-f1e138bba70e', 'method': 'GET', 'path': '/data/predictions/ ', 'user_hash': None}
INFO:bipolar-api.middleware:Request completed: request_id=dded935c-de8d-4c26-b871-f1e138bba70e, status=400, duration=205.92ms, user_hash=none
INFO:httpx:HTTP Request: GET http://testserver/data/predictions/%20 "HTTP/1.1 400 Bad Request"
---------------------------------------------------------------------------------------------- Captured log call -----------------------------------------------------------------------------------------------
DEBUG    asyncio:proactor_events.py:631 Using proactor: IocpProactor
INFO     bipolar-api.middleware:middleware.py:53 Request started: {'request_id': '0620d513-f2dd-4dba-ae4a-e52862cfb887', 'method': 'GET', 'path': '/data/predictions/', 'user_hash': None}
INFO     bipolar-api.middleware:middleware.py:67 Request completed: request_id=0620d513-f2dd-4dba-ae4a-e52862cfb887, status=404, duration=0.32ms, user_hash=none
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/data/predictions/ "HTTP/1.1 404 Not Found"
DEBUG    asyncio:proactor_events.py:631 Using proactor: IocpProactor
INFO     bipolar-api.middleware:middleware.py:53 Request started: {'request_id': 'dded935c-de8d-4c26-b871-f1e138bba70e', 'method': 'GET', 'path': '/data/predictions/ ', 'user_hash': None}
INFO     bipolar-api.middleware:middleware.py:67 Request completed: request_id=dded935c-de8d-4c26-b871-f1e138bba70e, status=400, duration=205.92ms, user_hash=none
INFO     httpx:_client.py:1025 HTTP Request: GET http://testserver/data/predictions/%20 "HTTP/1.1 400 Bad Request"
_______________________________________________________________________________ test_prediction_of_day_valid_uuid_calls_supabase _______________________________________________________________________________

    def test_prediction_of_day_valid_uuid_calls_supabase():
        """Test that valid UUID successfully calls Supabase"""
        valid_uuid = "123e4567-e89b-12d3-a456-426614174000"

        checkin_data = {
            "id": "checkin-123",
            "user_id": valid_uuid,
            "checkin_date": "2024-01-15T10:30:00Z",
            "hoursSlept": 6.5,
            "sleepQuality": 6,
            "energyLevel": 5,
            "depressedMood": 4,
            "anxietyStress": 6,
            "medicationAdherence": 1,
            "medicationTiming": 1,
            "compulsionIntensity": 0
        }

        mock_client = create_mock_supabase_client([checkin_data])

        async def mock_acreate_client(*args, **kwargs):
            return mock_client

        with patch.dict(os.environ, {
            "SUPABASE_URL": "https://test.supabase.co",
            "SUPABASE_SERVICE_KEY": "test-key"
        }):
>           with patch("api.dependencies.acreate_client", side_effect=mock_acreate_client):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_uuid_validation.py:288:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Python314\Lib\unittest\mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000230AC0DE7B0>

    def get_original(self):
        target = self.getter()
        name = self.attribute

        original = DEFAULT
        local = False

        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True

        if name in _builtins and isinstance(target, ModuleType):
            self.create = True

        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'

C:\Python314\Lib\unittest\mock.py:1473: AttributeError
=============================================================================================== warnings summary ===============================================================================================
..\..\Users\lucas\AppData\Roaming\Python\Python314\site-packages\slowapi\extension.py:717: 12 warnings
  C:\Users\lucas\AppData\Roaming\Python\Python314\site-packages\slowapi\extension.py:717: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    if asyncio.iscoroutinefunction(func):

tests/test_observability_middleware.py::test_middleware_works_with_privacy_endpoints
  C:\Users\lucas\AppData\Roaming\Python\Python314\site-packages\supabase\_sync\client.py:302: DeprecationWarning: The 'timeout' parameter is deprecated. Please configure it in the http client instead.
    return SyncPostgrestClient(

tests/test_observability_middleware.py::test_middleware_works_with_privacy_endpoints
  C:\Users\lucas\AppData\Roaming\Python\Python314\site-packages\supabase\_sync\client.py:302: DeprecationWarning: The 'verify' parameter is deprecated. Please configure it in the http client instead.
    return SyncPostgrestClient(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================================================================================== short test summary info ============================================================================================
FAILED tests/test_account_endpoints.py::test_export_patient_data - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_account_endpoints.py::test_delete_request_therapist_with_patients - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_account_endpoints.py::test_delete_request_patient_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_account_endpoints.py::test_undo_delete_invalid_token - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_account_endpoints.py::test_undo_delete_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_account_endpoints.py::test_undo_delete_expired - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_generate_data_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_generate_data_with_invalid_token_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_generate_data_with_admin_email_succeeds - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_generate_data_with_admin_role_succeeds - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_generate_data_with_non_admin_user_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_generate_data_without_bearer_prefix_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_admin_auth_missing_anon_key_returns_500 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestAdminAuthentication::test_admin_auth_uses_anon_client_not_service - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_default_parameters - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_custom_parameters - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_invalid_mood_pattern - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_validates_num_users_range - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_validates_checkins_per_user_range - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_returns_user_ids - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_with_patients_and_therapists - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_only_patients - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_only_therapists - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_rejects_zero_users - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDataGeneration::test_generate_data_with_legacy_num_users - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestStatsEndpoint::test_stats_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestStatsEndpoint::test_stats_with_invalid_token_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestStatsEndpoint::test_stats_with_valid_admin_returns_counts - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestStatsEndpoint::test_stats_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestStatsEndpoint::test_stats_handles_zero_counts - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestUsersEndpoint::test_users_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestUsersEndpoint::test_users_with_invalid_token_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestUsersEndpoint::test_users_with_valid_admin_returns_users_list - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestUsersEndpoint::test_users_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestUsersEndpoint::test_users_returns_empty_list_when_no_users - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_invalid_action_returns_400 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_delete_last_n_without_quantity_returns_400 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_delete_by_mood_without_pattern_returns_400 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_delete_before_date_without_date_returns_400 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_delete_all_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_delete_last_n_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints.py::TestDangerZoneCleanup::test_danger_zone_cleanup_no_test_patients_found - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestCleanupDataEndpoint::test_cleanup_data_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestCleanupDataEndpoint::test_cleanup_data_with_invalid_token_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestCleanupDataEndpoint::test_cleanup_data_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestCleanupDataEndpoint::test_cleanup_data_without_confirmation_returns_400 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestCleanupDataEndpoint::test_cleanup_data_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataCleanEndpoint::test_synthetic_clean_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataCleanEndpoint::test_synthetic_clean_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataCleanEndpoint::test_synthetic_clean_delete_all_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataCleanEndpoint::test_synthetic_clean_delete_last_n_without_quantity_returns_400 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataExportEndpoint::test_export_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataExportEndpoint::test_export_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataExportEndpoint::test_export_invalid_format_returns_400 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataExportEndpoint::test_export_json_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestSyntheticDataExportEndpoint::test_export_csv_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestToggleTestFlagEndpoint::test_toggle_flag_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestToggleTestFlagEndpoint::test_toggle_flag_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestToggleTestFlagEndpoint::test_toggle_flag_patient_not_found_returns_404 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestToggleTestFlagEndpoint::test_toggle_flag_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestRunDeletionJobEndpoint::test_deletion_job_without_auth_returns_401 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestRunDeletionJobEndpoint::test_deletion_job_with_non_admin_returns_403 - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_admin_endpoints_additional.py::TestRunDeletionJobEndpoint::test_deletion_job_success - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_data_generator_retry.py::TestCreateUserWithRetry::test_failure_after_max_retries - AssertionError: assert 'duplicate' in 'falha aps todas as tentativas'
FAILED tests/test_observability_middleware.py::test_middleware_works_with_predictions_endpoint - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_predictions_endpoint_no_checkins - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_predictions_endpoint_with_checkin - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_predictions_endpoint_with_type_filter - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_predictions_endpoint_with_window_days - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_prediction_of_day_endpoint_no_checkins - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_prediction_of_day_endpoint_with_checkin - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_prediction_of_day_endpoint_probability_normalization - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_predictions_endpoint.py::test_prediction_of_day_endpoint_missing_env_vars - assert 400 == 500
FAILED tests/test_privacy_endpoints.py::test_consent_endpoint_with_auth - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_privacy_endpoints.py::test_export_endpoint_with_auth - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_privacy_endpoints.py::test_erase_endpoint_with_auth - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_uuid_validation.py::test_latest_checkin_valid_uuid_calls_supabase - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_uuid_validation.py::test_predictions_valid_uuid_calls_supabase - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_uuid_validation.py::test_predictions_valid_uuid_with_query_params - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_uuid_validation.py::test_uuid_edge_cases - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
FAILED tests/test_uuid_validation.py::test_prediction_of_day_valid_uuid_calls_supabase - AttributeError: <module 'api.dependencies' from 'C:\\Coding\\bipolar-api-deploy\\api\\dependencies.py'> does not have the attribute 'acreate_client'
83 failed, 74 passed, 14 warnings in 12.16s
PS C:\Coding\bipolar-api-deploy>